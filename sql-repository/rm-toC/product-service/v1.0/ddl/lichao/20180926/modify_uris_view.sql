DROP VIEW IF EXISTS `sku_detail_uris_view`;
CREATE VIEW `sku_detail_uris_view` AS select `ps`.`product_id` AS `product_id`,`ps`.`sku_id` AS `sku_id`,`ps`.`user_defined_url` AS `user_defined_url`,`psa`.`color_id` AS `color_id`,`psa`.`spec_id` AS `spec_id` from (`rm_product`.`product_sku` `ps` join (select `rm_product`.`product_sku_attribute`.`sku_id` AS `sku_id`,max((case `rm_product`.`product_sku_attribute`.`attr_id` when 1 then `rm_product`.`product_sku_attribute`.`attr_val_id` else 0 end)) AS `color_id`,max((case `rm_product`.`product_sku_attribute`.`attr_id` when 2 then `rm_product`.`product_sku_attribute`.`attr_val_id` else 0 end)) AS `spec_id` from `rm_product`.`product_sku_attribute` where (`rm_product`.`product_sku_attribute`.`status` = 0) group by `rm_product`.`product_sku_attribute`.`sku_id`) `psa` on(((`ps`.`sku_id` = `psa`.`sku_id`) and (`ps`.`status` = 0) and (`ps`.`shelf_status` = 0))));
